<head>
    <title>Lewwis is cool</title>
    {% load static %}
    <link href="{% static '/_assets/literallycanvas.css' %}" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no" />

    <style type="text/css">
      .fs-container {
        width: 500px;
        margin: auto;
      }

      .literally {
        width: 100%;
        height: 50%;
        position: relative;
      }
    </style>
  </head>

  <body>
    <div class="fs-container">
      <div id="lc"></div>
    </div>

    <!-- you really ought to include react-dom, but for react 0.14 you don't strictly have to. -->
    <script src="{% static '/_js_libs/react-0.14.3.js' %}"></script>
    <script src="{% static '/_js_libs/literallycanvas.js' %}"></script>

    <script type="text/javascript">
      var lc = LC.init(document.getElementById("lc"), {
        imageURLPrefix: "{% static '/_assets/lc-images' %}",
        toolbarPosition: 'bottom',
        defaultStrokeWidth: 3,
        strokeWidths: [1, 2, 3, 5, 30]
      });
    </script>

<!-- <div id="response">
    <pre></pre>
</div> -->

<form id="my-form">
    <input type="text" id="title" name="title" placeholder="Title" />
    <input type="text" id="artist" name="artist" placeholder="Artist" />
    <input type="hidden" id="csrfmiddlewaretoken" name="csrfmiddlewaretoken" value="{{ csrf_token }}"/>
    <input type="hidden" id="img_data" name="img_data" value=""/>

    <button type="submit">Submit</button>
</form>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
    (function($){
        function processForm( e ){
            var img_data = getImgData();
            document.getElementById("img_data").setAttribute("value", img_data);
            $.ajax({
                url: '/external/',
                dataType: 'text',
                type: 'post',
                contentType: 'application/x-www-form-urlencoded',
                data: $(this).serialize(),
                success: function( data, textStatus, jQxhr ){
                    $('#response pre').html( data );
                },
                error: function( jqXhr, textStatus, errorThrown ){
                    console.log( errorThrown );
                }
            });

            e.preventDefault();
        }

        function getImgData(){
            var canvasElement = document.getElementById('lc').getElementsByTagName('canvas')[1]
            var MIME_TYPE = "image/png";
            var imgURL = canvasElement.toDataURL(MIME_TYPE);
            return imgURL;
        }

        $('#my-form').submit( processForm );
    })(jQuery);
</script>
</body>
</html>